@model GLJ.Models.Agenda.PDAgenda
<link href="@Url.Content("~/Content/fullcalendar/fullcalendar.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Content/fullcalendar/fullcalendar.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.livequery.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/i18n/datepickerPt-BR.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/datetimepicker.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/datetime.js")" type="text/javascript"></script>
<style>
    .customStyleDay
    {
        background-color: White;
    }
</style>
<script language="javascript" type="text/javascript">
    $(document).ready(function () {
        $("#popupAddEvent").dialog({ autoOpen: false, tilte: 'Dados para Agendamento', modal: true, resizable: false, height: 600, width: 650});

        //Traduzindo DatePicker
        $.datepicker.setDefaults($.datepicker.regional['pt-BR']);

        //Configurando Data Inicio
        $("#txtDataEntrega").datetimepicker({
            showOn: "button",
            buttonImage:'@Url.Content("~/Content/img/calendar.png")',
            buttonImageOnly: true,
            dateFormat: 'dd/mm/yy',
            beforeShow: function (input, inst) {
                setTimeout(function () { $(".ui-datepicker").css("z-index", 99999); }, 10);
            }
        });

        $('.fc-view fc-view-month fc-grid').attr('style', '-moz-user-select: none;display: block;');

        //Inicializar Calendario
        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek '
            },
            aspectRatio: 3, //Tamanho da coluna em relação a tela
            weekends: false, //Não mostra fim de Semana
            editable: true, //se pode ser modificado ou não
            eventSources: [{//busca os eventos na base de dados
                url: '@Url.Action("BuscarAgenda", "Agenda")',
                type: 'POST',
                error: function () {
                    alert('Aconteceu um erro enquanto consultava a agenda!');
                },
                color: 'yellow',   // a non-ajax option
                textColor: 'black' // a non-ajax option
            }],
            eventRender: function (event, element, view) {//Criar os eventos customizados
                var imageTitle = '<img src="@Url.Content("~/Content/img/")' + event.nameImageTitle + '" />';
                var html = imageTitle + '<b>' + event.title + '</b>';
                $(element).html(html);
            },
            dayClick: function (date, allDay, jsEvent, view) {//Clique na coluna dia
                $('#formPedido').reset();
                //Mostra a Modal Vazia
                ShowEventModal();
            },
            eventClick: function (calEvent, jsEvent, view) {//clique no evento
                //Preenche a Modal  e mostra
                $('#txtDescricao').val(calEvent.title);
                $('#txtCodigoPedido').val(calEvent.Pedido.Codigo);
                $('#txtDataEntrega').datepicker('setDate', calEvent.start);
                $('#txtCliente').val(calEvent.Pedido.Cliente.Nome);

                ShowEventModal();
            },
            eventDrop: function (event, dayDelta, minuteDelta, allDay, revertFunc, jsEvent, ui, view) {//trocar o evento para outro dia
                //Salvar Evento trocado de dia
                $.ajax({
                    url: url + '/Agenda/SalvarEvento/?codigoAgenda=' + event.id + '&codigoPedido=' + event.Pedido.Codigo + '&data=' + $.fullCalendar.formatDate(event.start, "dd/MM/yyyy hh:mm:ss"),
                    type: 'GET',
                    success: function (data) {
                        if (data.Success) {
                            $('.success').html(data.Mensage);
                            $('.success').show();
                            $('#calendar').fullCalendar('refetchEvents');
                        }
                        else {
                            $('.error').html(data.Mensage);
                            $('.error').show();
                        }
                    }
                });
            }
        });

    });

    function ShowEventModal() {
        $("#popupAddEvent").dialog('open');
    }
</script>
<div id="fullCalender">
    <div id='calendar' style='margin: 3em 0; font-size: 13px; width: 90%; margin: 0px auto;'>
    </div>
</div>
<div id="popupAddEvent" title="Dados para Agendamento">
    <div class="divTituloPagina">
        <h3>
            Dados para Agendamento</h3>
    </div>
    @using (Ajax.BeginForm("SalvarRascunhoPedido", "Pedido", new AjaxOptions()
        {
            HttpMethod = "Post",
            OnSuccess = "success"
        }, new { @class = "uniForm", id = "formPedido" }))
    {           
        <div class="ctrlHolder">
            @Html.LabelFor(a => a.AgendaEntrega.Descricao)
            @Html.TextBoxFor(a => a.AgendaEntrega.Descricao, new { @class = "textInput", style = "width: 50%", id = "txtDescricao", placeholder = Html.PlaceHolder(a => a.AgendaEntrega.Descricao) })
            <p class="formHint">
                @Html.ValidationMessageFor(a => a.AgendaEntrega.Descricao)</p>
            <img src='@Url.Content("~/Content/img/info_tooltip.png")' title="@Html.Help(a => a.AgendaEntrega.Descricao)" alt=""  />
        </div>
        <div class="ctrlHolder">
            @Html.LabelFor(p => p.Pedido.Codigo)
            @Html.TextBoxFor(p => p.Pedido.Codigo, new { @class = "textInput", style = "width: 50%", id = "txtCodigoPedido", placeholder = Html.PlaceHolder(p => p.Pedido.Codigo) })
            <p class="formHint">
                @Html.ValidationMessageFor(m => m.Pedido.Codigo)</p>
            <img src='@Url.Content("~/Content/img/info_tooltip.png")' title="@Html.Help(m => m.Pedido.Codigo)" alt=""  />
        </div>
        <div class="ctrlHolder">
            @Html.LabelFor(p => p.Pedido.Cliente.Nome)
            @Html.TextBoxFor(p => p.Pedido.Cliente.Nome, new { @class = "textInput", style = "width: 50%", id = "txtCliente", placeholder = Html.PlaceHolder(p => p.Pedido.Cliente.Nome) })
            <p class="formHint">
                @Html.ValidationMessageFor(p => p.Pedido.Cliente.Nome)</p>
            <img src='@Url.Content("~/Content/img/info_tooltip.png")' title="@Html.Help(p => p.Pedido.Cliente.Nome)" alt=""  />
        </div>
        <div class="ctrlHolder">
            @Html.LabelFor(a => a.AgendaEntrega.DataInicio)
            @Html.TextBoxFor(a => a.AgendaEntrega.DataInicio, new { @class = "textInput", style = "width: 50%", id = "txtDataEntrega", placeholder = Html.PlaceHolder(a => a.AgendaEntrega.DataInicio) })
            <p class="formHint">
                @Html.ValidationMessageFor(a => a.AgendaEntrega.DataInicio)</p>
            <img src='@Url.Content("~/Content/img/info_tooltip.png")' title="@Html.Help(a => a.AgendaEntrega.DataInicio)" alt=""  />
        </div>
            
        <div class="buttonHolder">
            <input type="submit" class="primaryAction" value="Continuar" />
            <input type='button' class="primaryAction" onclick="$('#popupAddEvent').dialog('close');" value="Cancelar"/>
        </div>
    }
</div>
